---
import Link from "../Link.astro";

const { tuneMeta } = Astro.props;

import { getCollection, getEntry } from "astro:content";
const relatedTunes = tuneMeta.relatedTunes
  ? await getCollection("tunes", ({ slug, data }) => {
      return tuneMeta.relatedTunes.includes(data.title);
    })
  : [];
---

{tuneMeta.rhythm ? <p>Rhythm: {tuneMeta.rhythm}</p> : null}
{tuneMeta.source ? <p>Source: {tuneMeta.source}</p> : null}
{
  tuneMeta.tuneArch ? (
    <p>
      More info:{" "}
      <Link href={tuneMeta.tuneArch} target="_blank">
        Traditional Tune Archive
      </Link>
    </p>
  ) : null
}
{
  relatedTunes && relatedTunes.length > 0 && (
    <div class="flex items-center gap-2">
      <p>Related tunes:</p>
      <ol class="flex items-center gap-2">
        {relatedTunes.map((relatedTune) => (
          <li>
            <Link href={`/tunes/${relatedTune.slug}`}>
              {relatedTune.data.title}
            </Link>
          </li>
        ))}
      </ol>
    </div>
  )
}
